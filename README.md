# z840-benchmarks
Results of running compile benchmarks on a new z840 with various storage configurations

# Overview
I got a new workstation for my productivity machine. Before setting it up, I decided to run some benchmarks to determine what was the best storage configuration to use.

# System Configuration
## BOM
| Quantity | Part Number | Description |
| --- | --- | --- |
| 1 | K7P13UA#ABA | Z840/ZD2.3+/256K/32Bb/B/kpA US |
| 4 | J9P82AA | HP 8GB (1x8GB) DDR4-2133 ECC Reg RAM |
| 2 | N1T07AT | NVIDIA Quadro K420 2GB DL-DVI(I)+DP |
| 1 | K5J28AT | HP 4-Bay SAS-SATA 2.5in High Density Storage Kit Z840 |
| 4 | L5B75AA | 600GB 15k RPM SAS SFF Hard Drive  |
| 1 | M1F73AA | HP Z Turbo Drive 256GB PCIe |

## Details
This provides:
  * Dual E5-2650 v3 CPUs (XEON, 10-core, 2.30 GHz)
  * Intel C612 chipset
  * 64 GB of 2.133 GHz DDR ECC RAM
  * Dual Quadro K240 2 GB graphics cards (with DL-DVI-I and DP connectors)
  * Integrated Intel I210AT PCIe GbE NIC
  * Integrated Intel I218LM PCIe GbE NIC
  * Integrated LSI Logic / Symbios Logic SAS2308 PCI-Express Fusion-MPT SAS-2
  * HP Z Turbo Drive 256 GB PCIe SSD
  * HP Z Turbo Drive G2 256 GB PCIe SSD
  * Quad 600 GB 15K RPM SAS drives (while leaving room for 2 additional 3.5" drives or 4 additional 2.5" drives)
  * DVD-RAM/±R/ ±RW optical drive

# Windows Benchmark
The systems came pre-installed with Windows 7.1 Pro, 64-bit. The numbers are pretty useless but for comparison,
the Windows Experience Index numbers were:
  * Processor: 7.8
  * Memory (RAM): 7.9
  * Graphics: 6.8
  * Gaming graphics: 6.8
  * Primary hard disk: 7.9
  * Overall: 6.8

# Linux Benchmarks
Since I usually use my machine for software development, I focused on benchmarks which simulated that. I used the [Phoronix Test Suite](http://www.phoronix-test-suite.com) (PTS). I did all my tests with CentOS 7.2. I created a kickstart file which setup everything except for the storage system. I started a web server on my laptop and made the kickstart available. Then I booted off a USB key with the CentOS 7.2 image on it and when the menu was displayed, I edited the command line to add `ks=http://cv-laptop/ks.cfg` so it would install the OS from the USB key but use my specialized configuration. When `anaconda` started the install, it would stop to let me change the configuration as desired. Then I would start the install. After the install was finished, I used `rsync` to copy over the `benchmark` directory with the files needed to run the benchmark from my laptop to the `z840` directory on the workstation. Then, on the workstation, I started `glances` running in one window which was half the screen (so I could keep an eye on system utilization during the run) and ran `z840/setup` in another window which was also half the screen. Then I let the benchmark run. When it was done, I used `rsync` to copy the results from the `results` directory on the workstation back to a directory on my laptop. Those results are in subdirectories of the `raw-data` directory which are named to indicate the test configuration.

The `setup` script not only runs the PTS benchmarks but also:
  * downloads the Linux kernel source RPM
  * runs `rpmbuild --rebuild` on the source RPM and saves the time to build it to the file `results/kernel-build-time`
  * runs `sos-report` and saves the resulting tarball in the `results` directory
  * copies `/root/anaconda-ks.cfg` to the `results` directory
  * copies `~/.phoronix-test-suite/test-results` to the `results` directory
  * runs `systemd-analyze` to get the boot time and saves it to `results/boot-time`

After all the tests were run, I merged all of the PTS results and added the kernel build times and boot times by editing the `composite.xml`. I then refreshed the graphs so the added results will show up in the PTS report.

The results are detailed in the reports generated by PTS. I have three sets of data:
  * compile-test: `test-results/compile-test/index.html`  
    The results from running on the z840
  * vb-laptop-results: `test-results/vb-laptop-results/index.html`  
    The results from running in VirtualBox VMs on the z840 and running the tests on my 8570w laptop
  * full-results: `test-results/full-results/index.html`  
    The first two sets merged together

# Install
The `benchmark/setup` script expects the file `benchmark/data.tar.gz` which (at
1.1 GB) was too large to be able to post to GitHub.com (even with lfs) so the
file is not in the repository. It can be regenerated by doing the following:
  1. install the Phoronix Test Suite on a system
  2. make the download cache
  3. make a tarball called `data.tar.gz` of all of the files in
     `~/.phoronix-test-suite`
This saves redownloading the files for every test run.
